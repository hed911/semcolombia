<h1>Departamentos</h1>
<%= form_tag(export_xls_departamentos_path, method: "post",  :multipart => true, "data-ajax" => "false" ) do %>
	<div class="panel panel-danger">
		<div class="panel-heading">
			<h3 class="panel-title"></h3>
		</div>
		<div class="panel-body">
			<div class="table-responsive">
				<table id="table-result" class="table table-bordered table-hover table-striped tablesorter">
				  <thead>
				    <tr>
				      <th data-sort="int">#</th>
				      <th data-sort="string">Nombre</th>
							<th>Acción</th>
							<th>Acción</th>
				    </tr>
				  </thead>
				  <tbody id="table-result-body">
				  	<% count = 0 -%>
						<% @departamentos.each do |departamento| -%>
							<% count += 1 -%>
							<tr class="<%= departamento.table_class %>">
								<td><%= count %></td>
						    <td><%= departamento.nombre %></td>
								<td>
						      <button onclick="show_municipios(<%= departamento.id %>);" type="button" class="btn btn-default">
										<i class="fa fa-info-circle" aria-hidden="true"></i> Detalle
									</button>
						    </td>
								<td>
									<%= link_to departamento_users_path(departamento.id), :class => "btn btn-default", :title => "Usuarios" do %>
										<i class="fa fa-hospital-o"></i> Usuarios(<%= departamento.usuarios.count %>)
									<% end %>
								</td>
							</tr>
						<% end -%>
				  </tbody>
				</table>
			</div>
		</div>
	</div>
	<%= submit_tag "✓Exportar Datos", :name => 'export_data' %>
<% end %>
<div id="modal"></div>
<script>

	function show_municipios(id){
		$.get("/departamentos/" + id + '/municipios',
			{
			},function(result){
				$('#modal').empty();
				$('#modal').append($.parseHTML( result ));
				$("#municipios").modal('show');
		}, "text");
	}

</script>
